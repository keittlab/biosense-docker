#!/bin/bash

IMAGE_SOURCE_DIR="source_images"
IMAGE_DEST_DIR="customized_images"

RASPIOS_DIR_DATE="2024-03-15"
RASPIOS_IMAGE_DATE="2024-03-15"

RASPIOS_IMAGE="${RASPIOS_IMAGE_DATE}-raspios-bookworm-arm64-lite.img.xz"
RASPIOS_SHA256="${RASPIOS_IMAGE_DATE}-raspios-bookworm-arm64-lite.img.xz.sha256"
RASPIOS_BASE_URL="https://downloads.raspberrypi.com/raspios_lite_arm64/images/raspios_lite_arm64-${RASPIOS_DIR_DATE}"

(cd $IMAGE_SOURCE_DIR && curl -O ${RASPIOS_BASE_URL}/${RASPIOS_IMAGE})
(cd $IMAGE_SOURCE_DIR && curl -O ${RASPIOS_BASE_URL}/${RASPIOS_SHA256})

SHA_FILE="${IMAGE_SOURCE_DIR}/${RASPIOS_SHA256}"
IMAGE_FILE="${IMAGE_SOURCE_DIR}/${RASPIOS_IMAGE}"

cat $SHA_FILE

CHECKSUM=$(awk '{ print $1 }' ${SHA_FILE}) && \
    echo "$CHECKSUM ${IMAGE_FILE}" > checksum.txt && \
    cat checksum.txt && \
    sha256sum -c checksum.txt

xz -d ${IMAGE_FILE}

rm -f ${IMAGE_FILE} ${SHA_FILE} checksum.txt

